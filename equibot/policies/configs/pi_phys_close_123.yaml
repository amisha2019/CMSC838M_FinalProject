# Using point cloud data from the specified directory
prefix: physics_close_123
mode: train
seed: 123
use_wandb: false  # Disable wandb logging
device: cpu  # Changed from cuda to cpu since CUDA is not available
log_dir: logs2/${mode}
eval_data_path: /fs/nexus-projects/Sketch_REBEL/equibot/data/close_phy/pcs

# Define the agent to use
agent:
  agent_name: equibot

# Define the data structure needed for the BaseDataset
data:
  dataset_class: base_dataset
  dataset:
    path: /fs/nexus-projects/Sketch_REBEL/equibot/data/close_phy/pcs
    num_points: 1024
    num_workers: 4  # Changed from 8 to 4 to match available CPUs
    dof: 7  # Changed from 4 to 7 to match dataset
    num_eef: 2  # Changed from 1 to 2 to match dataset
    eef_dim: 13  # Changed from 3 to 13 to match dataset
    num_augment: 0
    shuffle_pc: true
    # Adding required augmentation parameters
    aug_keep_original: true
    same_aug_per_sample: true
    aug_scale_low: 0.5
    aug_scale_high: 1.5
    aug_scale_aspect_limit: 1.0
    aug_scale_rot: -1
    aug_scale_pos: 0.1
    aug_zero_z_offset: false
    aug_center: [0., 0., 0.]
    reduce_horizon_dim: false
    min_demo_length: 15
    num_training_steps: 100000  # Adding num_training_steps
    obs_horizon: ${model.obs_horizon}
    pred_horizon: ${model.pred_horizon}

model:
  use_physics_embed: true         # Enable physics embedding
  physics_embed_dim: 4            # Match your encoder out_dim
  use_physics_supervision: true   # Enable physics supervision loss
  use_torch_compile: false        # Add torch compile parameter
  obs_horizon: 2
  ac_horizon: 8
  pred_horizon: 16
  obs_mode: pc
  ac_mode: rel
  hidden_dim: 32
  noise_scheduler:
    _target_: diffusers.schedulers.scheduling_ddpm.DDPMScheduler
    num_train_timesteps: 100
    beta_schedule: squaredcos_cap_v2
    clip_sample: true
    prediction_type: epsilon
  encoder:
    c_dim: ${model.hidden_dim}
    backbone_type: vn_pointnet
    backbone_args:
      h_dim: ${model.hidden_dim}
      c_dim: ${model.encoder.c_dim}
      num_layers: 4
      knn: 8

loss:
  lambda_phys: 0.1                # Weight of physics-recon loss

training:
  batch_size: 32
  num_epochs: 50
  lr: 1e-4                       # Learning rate
  weight_decay: 1e-6             # Weight decay parameter
  save_interval: 50
  eval_interval: 1000000         # Set a very large number to effectively disable evaluation
  num_eval_episodes: 50           # Number of episodes to evaluate on
  ckpt: null                     # Checkpoint parameter
  vis_interval: 100              # Visualization interval

# Add environment configuration
env:
  env_class: close
  dof: 7                         # Changed from 4 to 7 to match dataset
  num_eef: 2                     # Changed from 1 to 2 to match dataset
  eef_dim: 13                    # Changed from 3 to 13 to match dataset
  vectorize: false
  args:
    num_eef: 2                   # Changed from 1 to 2 to match dataset
    dof: 7                       # Changed from 4 to 7 to match dataset
    seed: 123
    obs_mode: pc
    ac_mode: rel
    max_episode_length: 100
    num_points: 1024
    randomize_rotation: false
    randomize_scale: false
    scale_low: 1.0
    scale_high: 1.0
    scale_aspect_limit: 100.0
    uniform_scaling: false
    
# Evaluation config
eval:
  last_ckpt: 1999
  num_ckpts_to_eval: 5

# Hydra config
hydra:
  run:
    dir: ${log_dir}/${prefix}

# Wandb config (even though disabled)
wandb:
  entity: anukriti
  project: equibot_physics 